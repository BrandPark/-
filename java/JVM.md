# JVM

`JVM`은 바이트코드로 컴파일 되는 프로그램을 실행할 수 있게 해주는 가상 머신입니다. 쉽게 말하면 바이트코드가 실행되는 Runtime 환경입니다.

JVM은 실행되면 OS로부터 메모리를 할당받아 동작합니다.

## JVM 구조

![image](https://user-images.githubusercontent.com/53790137/154963019-af358271-a3b1-4bb9-a2aa-ff89eca1894a.png)

**1. 클래스 로더 시스템**
바이트코드를 읽어 메모리에 적재하는 역할을 합니다.
- **1.로딩** : 바이트코드를 읽어 클래스의 메타 정보들을 바이너리 데이터로 만들어 메소드 영역에 저장합니다. 메타 정보에는 FQCN, 클래스, 인터페이스, 이늄, 메소드, 변수 등이 저장됩니다. 로딩이 끝나면 해당 클래스의 클래스 객체(Class<>)를 생성하여 힙영역에 저장합니다.
- **2.링크** : .class 파일 형식이 유효한지 검증하고, 클래스 변수(static 변수)와 기본값에 필요한 메모리를 할당합니다.
- **3.초기화**: 심볼릭 메모리 레퍼런스를 메서드 영역에 있는 실제 레퍼런스로 교체합니다. 이 단계는 선택적으로 동작합니다. 로드 타임 때 초기화 될 수도 있고 런타임에 실제 객체가 사용될 때 동작할 수도 있습니다.

**2. 메모리**
- **스택** : 스레드에 의해 실행된 메서드 콜 프레임이 쌓이는 스택입니다. 지역 변수, 리턴 값, 메서드 콜 프레임이 저장됩니다. 스레드마다 가지고있습니다.
- **PC** : 스레드가 현재 실행할 스택 프레임을 가리키는 포인터를 저장합니다. 스택마다 가지고있습니다.
- **네이티브 메소드 스택** : 네이티브 메소드 인터페이스를 호출 하는 콜 프레임이 쌓이는 스택입니다.
- **힙** : 동적으로 생성된 객체들이 저장되는 공간입니다. 모든 스레드가 공유하는 공간입니다.
- **메소드** : 클래스 로더에 의해 로드된 클래스의 메타 정보와 메서드 코드, Static 변수들이 저장됩니다.

**3. 실행 엔진**
- **인터프리터** : 바이트코드를 한 줄 한 줄 런타임에 읽고 네이티브 코드로 변환하여 실행하는 엔진입니다. 한 줄씩 동작하여 최적화가 이루어지지 않아 속도가 느립니다. 런타임에 해석하여 실행하기 때문에 어떤 OS에서도 JVM만 있다면 실행가능합니다. 
- **JIT컴파일러** : 속도가 느린 인터프리터의 문제를 해결하기 위해 도입된 기술입니다. 자주 반복되는 코드를 미리 체크하여 네이티브코드로 바꿔둡니다. 인터프리터는 네이티브 코드로 컴파일된 코드를 바로 실행합니다. 
- **GC** : 힙 영역에서 더이상 참조되지 않는 객체들을 모아서 메모리를 반환하여 정리합니다. 

