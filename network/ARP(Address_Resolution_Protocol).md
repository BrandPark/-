# ARP(Address Resolution Protocol)

`ARP`는 **논리적인 주소(IP)의 물리적인 주소(MAC)를 확인하는 작업**입니다. 통신할 단말이 물리 주소를 필요로 할 때 사용됩니다. 

## ARP는 왜 필요할까요?

PC가 **네트워크를 통해 메시지를 보내려면 OSI 모델을 따라서 Encapsulation이 필요**합니다.

즉, 4계층 헤더의 TCP/UDP 포트, 3계층에서 출발, 도착지의 IP 주소, 2계층 헤더의 출발, 도착지의 MAC 주소와 같은 헤더 정보를 모두 채워야 합니다. 

생각을해보면 **목적지의 MAC 주소를 제외하고는 클라이언트에서 채워 넣을 수 있습니다.** 그래서 **목적지 MAC 주소를 채우기 위해 먼저 보내는 것이 `ARP Request`**입니다.

ARP 요청을 통해 MAC 주소를 알아낸 후 헤더 정보를 모두 채워서 메시지를 보냅니다.

## ARP 과정
**1. ARP 요청**
<br>: 송신자는 (출발지(자신) MAC 주소 + 출발지 IP + 목적지 IP)의 정보로 Broadcast Domain에 포함된 PC들에게 **`Broadcast`**시킵니다.

**2. ARP Reply**
<br>: 요청을 수신한 PC들은 목적지 IP주소를 확인하고 자신이 아니라면 삭제하고, 자신이 맞다면 자신의 MAC 주소를 포함시켜서 응답을 보냅니다. 이때 **`Unicast` 방식으로 전송**합니다. 

## ARP가 사용되는 경우 4가지**

<img src="https://user-images.githubusercontent.com/53790137/151483305-ce576644-ba37-45fb-8cc8-56f341ebc2d9.png" width="500" height="400">

## ARP Cache Table

요청을 보낼 때마다 ARP 요청을 하는 것은 굉장히 큰 낭비입니다. 

그래서 ARP 요청을 통해 MAC주소를 성공적으로 얻어낸 장치는 ARP 테이블에 IP와 MAC주소를 매핑하여 캐싱합니다.

후속 통신에서는 ARP 요청을 다시 보내는 대신 캐시 테이블을 먼저 확인하여 사용합니다. 테이블의 각 엔트리는 설정된 시간동안 보관됩니다.

(Windows에서는 CMD에서 `arp -a`를 입력하면 ARP 테이블 정보를 볼 수 있습니다.)

## 마무리

> **IP 주소의 통신은 사실 각 라우터 hop 에서 일어나는 MAC 주소와 MAC 주소 통신의 연속적인 과정이다.**

ARP를 이해한다면 위의 말을 이해할 수 있게 됩니다.
