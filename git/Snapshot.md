# Snapshot

`Git`은 **snapshot based VCS**입니다. 우리가 커밋을 하면 그 시점의 파일들을 스냅샷으로 만들어 저장합니다. 

## 어떻게 데이터를 저장할까?

깃은 커밋하면 그 순간 순간들을 스냅샷으로 만들어 저장합니다. 

예를 들어, snapshot.txt 파일을 처음 커밋하면 rev1에 저장되고, 수정 후 다시 커밋하면 rev2에 저장됩니다.

이때 rev1과 rev2가 가리키는 스냅샷들은 파일이 통째로 저장됩니다. snapshot.txt 파일이 1K 용량을 가진다면 총 2K를 저장하는 것이죠.

그림으로 표현하면 다음과 같습니다. 

![image](https://user-images.githubusercontent.com/53790137/152641094-1f175000-162c-4c0d-81c2-6bbfa6b1d3ba.png)

그러면 의문이 생길것입니다. **매번 통째로 저장하면 너무 비효율적 아닌가?** 

`Git`은 처음에는 성능과 편리성을 위해 이 방식으로 저장하고 **적절한 시점에 GC가 실행되어 가장 마지막 커밋을 제외하고 `델타`를 저장**합니다.

`델타`란 **커밋의 변경 부분**을 말합니다. 즉 diff 파일입니다. 그림으로 표현하면 다음과 같습니다.

![image](https://user-images.githubusercontent.com/53790137/152641193-49f1d408-8140-438f-8446-755753ab400a.png)

만약 `rev4`로 checkout을 하면 rev6파일에 re5, rev4의 델타를 적용해서 반환합니다.

또 diff파일을 gzip으로 압축하기 때문에 실제로 저장하는 용량은 더욱 적습니다. 

## 왜 가장 마지막이 snapshot일까?

마지막 버전의 파일이 스냅샷인 이유는 우리가 가장 궁금할 확률이 높은 파일이 대부분 마지막 버전의 파일이기 때문입니다.

만약 가장 처음의 커밋이 스냅샷이고 이후가 델타라면, 최신 버전의 파일을 보기위해서 첫 스냅샷부터 최근까지의 델타를 모두 적용해야 합니다. 

## 스냅샷 연결 리스트

`스냅샷`들은 **각각 자신의 해시 값을 가지고 있습니다.** 

`Commit`도 **자신의 해시 값을 가지고 있으며 스냅샷의 해시값과 부모 커밋의 해시값 등의 메타정보를 가지고 있습니다.**

![image](https://user-images.githubusercontent.com/53790137/152641860-9ede977e-eec3-4a9a-bfc4-68a008f5e798.png)

여기서 `tree`는 스냅샷을 의미한다. 이렇게 커밋은 자신의 부모 커밋의 레퍼런스를 가지고 연결리스트로 구현되어 있다. 

## 참고

- [공식문서](https://git-scm.com/book/ko/v2/Git-%EB%B8%8C%EB%9E%9C%EC%B9%98-%EB%B8%8C%EB%9E%9C%EC%B9%98%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)
- [dogfeet](http://dogfeet.github.io/articles/2012/git-delta.html)